package nubit

import (
	"testing"

	"github.com/stretchr/testify/assert"
)

func TestEncodeBlobData(t *testing.T) {
	data := BlobData{
		NubitHeight: []byte{0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x03, 0x04},
		Commitment: []byte{
			0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,
			0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,
			0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,
			0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,
		},
	}
	msg, err := TryEncodeToDataAvailabilityMessage(data)
	assert.NoError(t, err)
	assert.NotNil(t, msg)
	assert.NotEmpty(t, msg)
}

func TestEncodeDecodeBlobData(t *testing.T) {
	data := BlobData{
		NubitHeight: []byte{0x00, 0x00, 0x00, 0x00, 0x01, 0x02, 0x03, 0x04},
		Commitment: []byte{0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,
			0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,
			0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,
			0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08},
	}
	msg, err := TryEncodeToDataAvailabilityMessage(data)
	assert.NoError(t, err)
	assert.NotNil(t, msg)
	assert.NotEmpty(t, msg)

	// Check blob ID
	decoded_data, err := TryDecodeFromDataAvailabilityMessage(msg)
	assert.NoError(t, err)
	assert.Equal(t, data.NubitHeight, decoded_data.NubitHeight)
	assert.Equal(t, data.Commitment, decoded_data.Commitment)
}
